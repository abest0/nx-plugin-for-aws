default:
  image: node:20
  before_script:
    - npm install -g pnpm@9
    - pnpm install --frozen-lockfile --prefer-offline

stages:
  - build
  - deploy

build-job:
  stage: build
  script:
    - pnpm nx build <%= infraProject %>
  artifacts:
    paths:
      - dist/**/*

deploy-job:
  stage: deploy
  environment: beta
  variables:
    AWS_CREDS_TARGET_ROLE: <%= roleArn %>
    AWS_DEFAULT_REGION: <%= region %>
  script:
    - pnpm nx deploy <%= infraProject %> --skip-nx-cache